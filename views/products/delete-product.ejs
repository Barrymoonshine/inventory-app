<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head.ejs')%>
  <body>
    <%- include('../partials/nav.ejs')%>
    <div class="delete-product-content">
      <h2>Are you sure you want to delete <%=product.name %> ?</h2>
      <form class="delete-form" data-doc="<%= product._id %>">
        <label for="password"> Password:</label>
        <input
          type="password"
          id="password"
          name="password"
          required
          placeholder="Password"
        />
        <div class="password-warning hidden">Please enter a valid password</div>
        <button id="delete">Delete</button>
      </form>
    </div>
    <%- include('../partials/footer.ejs')%>
  </body>
  <script>
    const deleteForm = document.querySelector('.delete-form');
    const passwordInput = document.getElementById('password');
    const passwordWarning = document.querySelector('.password-warning');

    deleteForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const endpoint = `/products/${e.target.dataset.doc}`;
      try {
        const response = await fetch(endpoint, {
          method: 'DELETE',
          headers: {
            authorisation: `${document.getElementById('password').value}`,
          },
        });
        const data = await response.json();
        data.message === 'Unauthorized'
          ? ((passwordWarning.className = 'password-warning'),
            (passwordInput.style.border = ' 1px solid #dc2626'))
          : ((passwordWarning.className = 'password-warning hidden'),
            (passwordInput.style.border = ''),
            (window.location.href = data.redirect));
        window.location.href = data.redirect;
      } catch (err) {
        console.log(err);
      }
    });
  </script>
</html>
